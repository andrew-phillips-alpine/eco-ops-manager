version: '3.8'

services:
  eco-ops-manager:
    image: ghcr.io/andrew-phillips-alpine/eco-ops-manager:latest
    container_name: eco-ops-manager
    restart: unless-stopped
    environment:
      - NODE_ENV=production
      - PORT=3000
      - APP_NAME=eco-ops-manager
      - FORM_ENDPOINT=${FORM_ENDPOINT}
      - OPENWEATHER_API_KEY=${OPENWEATHER_API_KEY}
      - USE_MOCK_DATA=true
    networks:
      - buildlabs-net
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.eco-ops-manager.rule=Host(`eco-ops-manager.alpineappfactory.com`)"
      - "traefik.http.routers.eco-ops-manager.entrypoints=websecure"
      - "traefik.http.routers.eco-ops-manager.tls=true"
      - "traefik.http.routers.eco-ops-manager.tls.certresolver=cloudflare"
      - "traefik.http.routers.eco-ops-manager.tls.domains[0].main=alpineappfactory.com"
      - "traefik.http.routers.eco-ops-manager.tls.domains[0].sans=*.alpineappfactory.com"
      - "traefik.http.services.eco-ops-manager.loadbalancer.server.port=3000"

networks:
  buildlabs-net:
    external: true
